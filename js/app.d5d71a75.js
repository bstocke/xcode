(function(e){function t(t){for(var i,s,r=t[0],l=t[1],c=t[2],d=0,f=[];d<r.length;d++)s=r[d],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&f.push(a[s][0]),a[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(f.length)f.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,r=1;r<n.length;r++){var l=n[r];0!==a[l]&&(i=!1)}i&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},a={app:0},o=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=l;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},"2dd1":function(e,t,n){},"49f8":function(e,t,n){var i={"./en.json":"edd4"};function a(e){var t=o(e);return n(t)}function o(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=o,e.exports=a,a.id="49f8"},"4ffd":function(e,t,n){e.exports=n.p+"img/logo.27aaf036.png"},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"min-h-screen",attrs:{id:"app"}},[n("Navbar"),n("router-view"),n("Footer")],1)},o=[],s=function(){var e=this,t=e.$createElement,i=e._self._c||t;e._self._c;return e._m(0)},p=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("footer",{staticClass:"bg-white w-full fixed inset-x-0 bottom-0 h-14"},[n("div",{staticClass:"p-4"},[n("h1",{staticClass:"text-sm text-gray-400 text-center"},[e._v("Fladrop Â© 2021")])])])}],m={},g=Object(u["a"])(m,h,p,!1,null,null,null),v=g.exports,b={components:{Navbar:f,Footer:v}},w=b,_=Object(u["a"])(w,a,o,!1,null,null,null),y=_.exports,C=n("8c4f"),x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"max-w-screen-xl mx-auto"},[n("main",{staticClass:"mt-10 max-w-screen-xl mx-auto px-4 sm:mt-12 sm:px-6 md:mt-16 lg:mt-20 lg:px-8 xl:mt-28"},[n("div",{staticClass:"sm:text-center"},[n("h1",{staticClass:"text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl"},[n("span",{staticClass:"block"},[e._v(e._s(e.$t("home.hero.title1")))]),n("span",{staticClass:"block text-indigo-600"},[e._v(e._s(e.$t("home.hero.title2")))])]),n("p",{staticClass:"mt-3 text-base text-gray-500 sm:mt-5 sm:text-lg sm:max-w-2xl sm:mx-auto md:mt-5 md:text-xl"},[e._v(" "+e._s(e.$t("home.hero.subtitle"))+" ")]),n("div",{staticClass:"mt-5 sm:mt-8 sm:flex sm:justify-center"},[n("div",{staticClass:"rounded-md shadow"},[n("router-link",{staticClass:"w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 md:py-4 md:text-lg md:px-10",attrs:{to:"/s"}},[e._v(" "+e._s(e.$t("home.hero.btn.label"))+" ")])],1)])])])])},k=[],S={components:{}},E=S,F=Object(u["a"])(E,x,k,!1,null,null,null),R=F.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"w-full max-w-lg mx-auto px-4 pt-8 lg:pt-20 pb-20"},[e.isConnected?n("div",{staticClass:"w-full"},[e.isMobile?n("div",{staticClass:"flex items-center bg-yellow-50 rounded-lg shadow px-5 text-yellow-900 py-5 mb-5"},[n("div",{staticClass:"flex items-start"},[n("div",{staticClass:"flex items-center h-5"},[n("svg",{staticClass:"fill-current h-6 w-6 text-yellow-500 mr-4",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"}},[n("path",{attrs:{d:"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z"}})])]),n("div",{staticClass:"ml-3 text-sm"},[n("p",{staticClass:"text-yellow-800"},[e._v(" "+e._s(e.$t("share.kma.desc"))+" ")])])])]):e._e(),n("FileInput",{attrs:{peer:e.peer}}),n("FileList",{attrs:{files:e.files,isDownloadingAll:e.isDownloadingAll},on:{transfered:function(t){e.isDownloaded=!0},"download-all":function(t){return e.downloadAllAsZip()}}})],1):[e.isCallee||e.isSocketReady?n("div",{staticClass:"flex flex-col items-center justify-center"},[n("SpinnerLoading"),n("p",{directives:[{name:"show",rawName:"v-show",value:!e.isCallee,expression:"!isCallee"}],staticClass:"text-sm text-gray-500 mt-8"},[e._v(" Can not connect? "),n("button",{staticClass:"text-indigo-600",on:{click:function(t){return e.refreshPage()}}},[e._v(" refresh ")]),e._v(" this page and try again. ")])],1):n("QRCodeCard",{staticClass:"mx-auto"})]],2)},A=[],I=(n("159b"),n("b0c0"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"w-full max-w-sm py-8 px-4"},[e.isGenerating?n("div",{staticClass:"flex h-40 w-40 items-center justify-center mx-auto"},[n("SpinnerLoading")],1):n("img",{staticClass:"mx-auto h-40 w-40",attrs:{src:e.qrcodeURL,alt:"QR Code for connect"}}),n("p",{staticClass:"text-gray-800 font-semibold text-center"},[e._v(" "+e._s(e.$t("share.qrCode.caption"))+" ")]),n("div",{staticClass:"text-sm text-gray-600 flex items-center justify-center mt-2"},[n("p",{staticClass:"text-gray-500 text-center"},[e._v("or copy url")]),n("button",{staticClass:"ml-2 rounded focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",on:{click:e.copyUrl}},[n("svg",{staticClass:"h-6 w-6 text-gray-600 hover:text-indigo-600 fill-current"},[n("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}})])])])])}),O=[],j=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},L=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"sk-chase"},[n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"})])])}],z={name:"SpinnerLoading"},M=z,V=Object(u["a"])(M,j,L,!1,null,null,null),$=V.exports,P=n("d055"),T=n.n(P),N="https",q={name:"QRCodeCard",data:function(){return{qrcodeURL:"",descs:[{title:"Scan QR Code",subtitle:"You can use the Camera app on your smartphone to scan qr code"},{title:"Send URL to others",subtitle:"Copy URL and send it to your friend"}]}},components:{SpinnerLoading:$},computed:{isGenerating:function(){return""===this.qrcodeURL},roomId:function(){return this.$store.getters.roomId},isConnected:function(){return this.$store.getters.isConnected},isConnecting:function(){return!this.isConnected},url:function(){return this.roomId?N+"://"+location.host+"/s/"+this.roomId:"no"}},watch:{roomId:function(e){e&&this.generateQRCode()}},methods:{generateQRCode:function(){var e=this,t={color:{dark:"#1F2937FF",light:"#FFFFFFFF"}};T.a.toDataURL(this.url,t,(function(t,n){if(t)throw t;e.qrcodeURL=n}))},copyUrl:function(){var e=document.createElement("textarea");e.value=this.url,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}}},B=q,H=Object(u["a"])(B,I,O,!1,null,null,null),U=H.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"flex items-center justify-between bg-white mb-2 px-5 py-2"},[n("h1",{staticClass:"text-2xl text-gray-800 font-semibold tracking-wide"},[e._v(" "+e._s(e.$t("share.fileList.label"))+" ")]),e.files.length?n("button",{staticClass:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",attrs:{type:"submit"},on:{click:function(t){return e.$emit("download-all")}}},[e.isDownloadingAll?[e._v(" Downloading "),n("BounceLoading",{staticClass:"pl-2 h-6 w-8"})]:[e._v(" Download all ")]],2):e._e()]),0===e.files.length?n("div",{staticClass:"text-sm p-4"},[e._v(" "+e._s(e.$t("share.fileList.noFile"))+" ")]):e._l(e.files,(function(t,i){return n("FileListItem",{key:i,attrs:{file:t},on:{downloaded:function(t){return e.$emit("transfered")}}})}))],2)},Y=[],Q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mb-2 flex bg-white shadow hover:shadow-lg p-4 rounded-lg items-center"},[n("FileIcon",{attrs:{type:e.file.type}}),n("div",{staticClass:"px-2 overflow-hidden w-full"},[n("h4",{staticClass:"font-bold text-sm truncate"},[e._v(e._s(e.file.name))]),n("span",{staticClass:"text-gray-600 text-xs truncate"},[e._v(e._s(e.formatBytes(e.file.size)))])]),n("div",{staticClass:"flex w-10 justify-center items-center"},[n("FileAction",{attrs:{status:{state:e.file.state,progress:e.progress}},on:{download:function(t){return e.downloadFile(e.file)}}})],1)],1)},W=[],J=(n("b680"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{staticClass:"fill-current text-indigo-500",class:e.isMediaType?"w-8 h-4":"w-6 h-6",attrs:{xmlns:"http://www.w3.org/2000/svg"}},[e.isImage?n("path",{attrs:{d:"M18 8.503V3a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3.504l4.39-7.322a3 3 0 0 1 4.69-.582L18 8.503zm0 2.823l-3.828-3.814a1 1 0 0 0-1.563.195L8.836 14H17a1 1 0 0 0 1-1v-1.674zM3 0h14a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V3a3 3 0 0 1 3-3zm3 9a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0-2a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"}}):e.isVideo?n("path",{attrs:{d:"M4 2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H4zm9.98 1.605L16 1.585A2 2 0 0 1 17.414 1H18a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-.586A2 2 0 0 1 16 10.414l-2.02-2.019A4 4 0 0 1 10 12H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4h6a4 4 0 0 1 3.98 3.605zM17.415 9H18V3h-.586l-3 3 3 3zM5 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"}}):n("path",{attrs:{d:"M10.298 2H3a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V4.961L10.298 2zM3 0h8l5 4v13a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V3a3 3 0 0 1 3-3z"}})])}),Z=[],K=(n("2ca0"),{name:"FileIcon",props:{type:String},computed:{isMediaType:function(){return this.type.startsWith("image/")||this.type.startsWith("video/")},isImage:function(){return this.type.startsWith("image/")},isVideo:function(){return this.type.startsWith("video/")}}}),X=K,ee=Object(u["a"])(X,J,Z,!1,null,"bb6385e2",null),te=ee.exports,ne=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"w-full"},[4===e.state?n("svg",{staticClass:"h-3 w-4 mx-auto fill-current text-indigo-500",attrs:{xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"M5.486 9.73a.997.997 0 0 1-.707-.292L.537 5.195A1 1 0 1 1 1.95 3.78l3.535 3.535L11.85.952a1 1 0 0 1 1.415 1.414L6.193 9.438a.997.997 0 0 1-.707.292z"}})]):5===e.state?n("button",{staticClass:"focus:outline-none",on:{click:function(t){return e.$emit("download")}}},[n("svg",{staticClass:"w-10 h-10 text-indigo-500 fill-current hover:bg-gray-100 p-2 rounded-full",attrs:{xmlns:"http://www.w3.org/2000/svg"}},[n("defs",[n("filter",{attrs:{id:"a","color-interpolation-filters":"sRGB"}},[n("feFlood",{attrs:{"flood-opacity":".498","flood-color":"#000",result:"flood"}}),n("feComposite",{attrs:{in:"flood",in2:"SourceGraphic",operator:"in",result:"composite1"}}),n("feGaussianBlur",{attrs:{in:"composite1",stdDeviation:".3",result:"blur"}}),n("feOffset",{attrs:{result:"offset"}}),n("feComposite",{attrs:{in:"SourceGraphic",in2:"offset",result:"composite2"}})],1)]),n("path",{attrs:{d:"M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7z",filter:"url(#a)"}})])]):[0===e.progress?n("BounceLoading",{staticClass:"h-6 w-8"}):e.progress>0&&e.progress<=100?n("div",{staticClass:"w-full h-2 bg-gray-300 shadow rounded-full"},[n("div",{staticClass:"h-full bg-indigo-500 rounded-full",style:{width:e.progress+"%"}})]):e._e()]],2)},ie=[],ae=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},oe=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spinner"},[n("div",{staticClass:"bounce1"}),n("div",{staticClass:"bounce2"}),n("div",{staticClass:"bounce3"})])}],se={name:"BounceLoading"},re=se,le=(n("8e7a"),Object(u["a"])(re,ae,oe,!1,null,"100dc2e3",null)),ce=le.exports,ue={name:"FileAction",props:{status:Object},components:{BounceLoading:ce},computed:{progress:function(){return this.status.progress},state:function(){return this.status.state}}},de=ue,fe=Object(u["a"])(de,ne,ie,!1,null,null,null),he=fe.exports,pe=n("21a6"),me=n.n(pe),ge={name:"FileListItem",props:{file:Object},components:{FileIcon:te,FileAction:he},computed:{progress:function(){return this.file.recvSize/this.file.size*100}},methods:{formatBytes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=1024,i=t<0?0:t,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,o)).toFixed(i))+" "+a[o]},downloadFile:function(e){me()(e.objectURL,e.name),this.$emit("downloaded")}}},ve=ge,be=Object(u["a"])(ve,Q,W,!1,null,null,null),we=be.exports,_e={name:"FileList",props:{files:Array,isDownloadingAll:Boolean},components:{FileListItem:we,BounceLoading:ce}},ye=_e,Ce=Object(u["a"])(ye,G,Y,!1,null,null,null),xe=Ce.exports,ke=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"h-40 mt-1 py-5 flex items-center justify-center bg-white border-2 border-dashed border-gray-300 rounded-lg relative mb-10"},[n("div",{staticClass:"text-center absolute right-0 left-0"},[n("svg",{staticClass:"w-8 h-8 fill-current text-indigo-600 mx-auto",staticStyle:{width:"24px",height:"24px"},attrs:{viewBox:"0 0 24 24"}},[n("path",{attrs:{fill:"currentColor",d:"M2 12H4V17H20V12H22V17C22 18.11 21.11 19 20 19H4C2.9 19 2 18.11 2 17V12M12 2L6.46 7.46L7.88 8.88L11 5.75V15H13V5.75L16.13 8.88L17.55 7.45L12 2Z"}})]),n("p",{staticClass:"text-sm text-gray-600 mt-2"},[n("span",{staticClass:"text-indigo-600"},[e._v(e._s(e.$t("share.fileInput.label1")))]),e._v(e._s(e.$t("share.fileInput.label2"))+" ")])]),n("input",{staticClass:"cursor-pointer relative block opacity-0 w-full h-full",attrs:{type:"file",multiple:""},on:{change:e.processFiles}})])},Se=[],Ee={name:"FileInput",props:{peer:Object},methods:{processFiles:function(e){var t=this;e.target.files.forEach((function(e){t.peer.addFile(e)}))}}},Fe=Ee,Re=Object(u["a"])(Fe,ke,Se,!1,null,null,null),De=Re.exports,Ae=n("d4ec"),Ie=n("bee2"),Oe=(n("7db0"),n("bf19"),n("99af"),n("2b3d"),n("d3b7"),n("3ca3"),n("ddb0"),n("fb6a"),n("2f62"));i["a"].use(Oe["a"]);var je=new Oe["a"].Store({state:{isConnected:!1,isRestarting:!1,socketReady:!1,roomId:""},getters:{isConnected:function(e){return e.isConnected},isSocketReady:function(e){return e.socketReady},isRestarting:function(e){return e.isRestarting},roomId:function(e){return e.roomId}},actions:{setRoomId:function(e,t){var n=e.commit;n("setRoomId",t)},socketReady:function(e){var t=e.commit;t("socketReady")},connected:function(e){var t=e.commit;t("connected")},disconnected:function(e){var t=e.commit;t("disconnected")},restarting:function(e){var t=e.commit;t("restarting")},restarted:function(e){var t=e.commit;t("restarted")}},mutations:{setRoomId:function(e,t){e.roomId=t.roomId},socketReady:function(e){e.socketReady=!0},connected:function(e){e.isConnected=!0},disconnected:function(e){e.isConnected=!1},restarting:function(e){e.isRestarting=!0},restarted:function(e){e.isRestarting=!1}}}),Le=(n("d81d"),function(){}),ze=function(){function e(){Object(Ae["a"])(this,e)}return Object(Ie["a"])(e,null,[{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.map((function(e){return JSON.stringify(e,null,2)}));Le.apply(console,i)}}]),e}(),Me=ze,Ve=n("8055"),$e=n.n(Ve),Pe={ADDED:0,SYNCED:1,READYSEND:2,READYRECV:3,DONESEND:4,DONERECV:5},Te=Pe,Ne=function(){function e(){Object(Ae["a"])(this,e),this._elements=[]}return Object(Ie["a"])(e,[{key:"enqueue",value:function(e){this._elements.push(e)}},{key:"dequeue",value:function(){return this._elements.shift()}},{key:"length",value:function(){return this._elements.length}},{key:"isEmpty",value:function(){return 0==this._elements.length}},{key:"peek",value:function(){return this._isEmpty()?void 0:this._elements[0]}}]),e}(),qe=Ne,Be=function(){function e(t,n){Object(Ae["a"])(this,e),this._isSendingFile=!1,this._isInitiator=!1,this._files=[],this._config=t,this._fileQueue=new qe,this._s=$e.a.connect("https://signaling.bstocke.github.io/QR-file-share/"),this._handleSocketIOEvents(),this._roomId=n||this._randomToken(),this._createOrJoinRoom(),this._checkQueue()}return Object(Ie["a"])(e,[{key:"_handleSocketIOEvents",value:function(){var e=this;this._s.on("ipaddr",(function(e){Me.log("Server IP address is: "+e)})),this._s.on("created",(function(t,n){Me.log("Created room",t,"- my client ID is",n),e._isInitiator=!0,je.dispatch("setRoomId",{roomId:t}),e._createPeerConnection()})),this._s.on("joined",(function(t,n){Me.log("This peer has joined room",t,"with client ID",n),e._isInitiator=!1,e._createPeerConnection()})),this._s.on("full",(function(t){alert("Room "+t+" is full. We will create a new room for you."),e._reloadSharePage()})),this._s.on("ready",(function(){Me.log("Socket is ready"),je.dispatch("socketReady"),e._isInitiator&&e._createOffer({})})),this._s.on("log",(function(e){Me.log.apply(Me,e)})),this._s.on("message",(function(t){e._handleSignalingMessage(t)}))}},{key:"_handleSignalingMessage",value:function(e){if("offer"===e.type)Me.log("Got offer. Sending answer to peer."),this._handleOffer(e);else if("answer"===e.type)Me.log("Got answer."),this._handleAnswer(e);else if("candidate"===e.type)Me.log("Got candidate"),this._conn.addIceCandidate(new RTCIceCandidate(e.candidate));else if("fileAdded"===e.type){Me.log("File added");var t=e.fileInfo;t.state=Te.SYNCED,this._files.push(t),this._updateFileState(t)}else if("fileUpdated"===e.type){Me.log("File updated");var n=e.fileInfo,i=n.state,a=this._files.find((function(e){return e.id===n.id}));i===Te.SYNCED&&a.state===Te.ADDED&&(a.state=Te.READYSEND,this._createDataChannelForFile(a)),i===Te.READYRECV&&a.state===Te.READYSEND&&this._fileQueue.enqueue(a),i===Te.DONERECV&&(a.state===Te.READYSEND&&(a.state=Te.DONESEND,this._isSendingFile=!1),a.state===Te.READYRECV&&(a.state=Te.DONERECV))}}},{key:"_sendSignalingMessage",value:function(e){this._s.emit("message",{room:this._roomId,msg:e})}},{key:"_createPeerConnection",value:function(){Me.log("create peer connection..."),this._conn=new RTCPeerConnection(this._config),this._handlePeerConnectionEvents(),this._isInitiator&&(Me.log("creating data channel and offer"),this._channel=this._conn.createDataChannel("file-transfer"))}},{key:"_createOrJoinRoom",value:function(){this._s.emit("create or join",this._roomId)}},{key:"_tryRestartICE",value:function(){var e=this;Me.log("Trying to restart ICE..."),"failed"===this._conn.connectionState&&(this._createOffer({iceRestart:!0}),setTimeout((function(){return e._tryRestartICE()}),1500))}},{key:"_createOffer",value:function(e){var t=this;Me.log("Createing offer"),this._conn.createOffer(e).then((function(e){return t._setLocalDescription(e)})).catch((function(e){return Me.log(e)}))}},{key:"_createAnswer",value:function(){var e=this;this._conn.createAnswer().then((function(t){return e._setLocalDescription(t)})).catch((function(e){return Me.log(e)}))}},{key:"_handleOffer",value:function(e){var t=this;this._conn.setRemoteDescription(new RTCSessionDescription(e)).then((function(){return t._createAnswer()}))}},{key:"_handleAnswer",value:function(e){this._conn.setRemoteDescription(new RTCSessionDescription(e))}},{key:"_setLocalDescription",value:function(e){var t=this;this._conn.setLocalDescription(e).then((function(){t._sendSignalingMessage(e)}))}},{key:"_handlePeerConnectionEvents",value:function(){var e=this;this._conn.onicecandidate=function(t){Me.log("ice candidate generated"),t.candidate&&e._sendSignalingMessage({type:"candidate",candidate:t.candidate.toJSON()})},this._conn.ondatachannel=function(t){var n=t.channel;e._handleDataChannelMessage(n);var i=n.label,a=e._files.find((function(e){return e.id===i}));a&&(a.state=Te.READYRECV,a.object=[],e._updateFileState(a))},this._conn.onicegatheringstatechange=function(){return Me.log("[WebRTC] ICE gathering state changed: ".concat(e._conn.iceGatheringState))},this._conn.onsignalingstatechange=function(){return Me.log("[WebRTC] Signaling state change: ".concat(e._conn.signalingState))},this._conn.oniceconnectionstatechange=function(){Me.log("[WebRTC] ICE connection state change: ".concat(e._conn.iceConnectionState))},this._conn.onconnectionstatechange=function(){Me.log("[WebRTC] Connection state change: ".concat(e._conn.connectionState));var t=e._conn.connectionState;"connected"===t?(je.dispatch("connected"),je.dispatch("restarted")):"failed"===t&&e._isInitiator&&(je.dispatch("restarting"),e._tryRestartICE())}}},{key:"_handleDataChannelMessage",value:function(e){var t=this;e.binaryType="arraybuffer",e.onopen=function(){Me.log("[WebRTC] Data channel ".concat(e.label," state: ").concat(e.readyState))},e.onclose=function(){Me.log("[WebRTC] Data channel ".concat(e.label," state: ").concat(e.readyState))},e.onerror=function(e){return Me.log("Error in sendChannel: ".concat(e))},e.onmessage=function(n){var i=t._files.find((function(t){return t.id===e.label}));if(i.object.push(n.data),i.recvSize+=n.data.byteLength,Me.log("[File] Received ".concat(n.data.byteLength," bytes")),i.size===i.recvSize){var a=new Blob(i.object);i.downloadableFile=new File(i.object,i.name),i.objectURL=window.URL.createObjectURL(a),i.state=Te.DONERECV,t._updateFileState(i)}}}},{key:"_createDataChannelForFile",value:function(e){e.channel=this._conn.createDataChannel(e.id)}},{key:"_checkQueue",value:function(){var e=this;if(!this._isSendingFile){var t=this._fileQueue.dequeue();void 0!==t&&this._sendFile(t)}setTimeout((function(){return e._checkQueue()}),250)}},{key:"_askToSendFile",value:function(e){var t=this;this._isSendingFile?setTimeout((function(){return t._askToSendFile(e)}),500):this._sendFile(e)}},{key:"_sendFile",value:function(e){if(0!==e.size){this._isSendingFile=!0;var t=0,n=e.channel,i=65536,a=new FileReader;a.onerror=function(e){return Me.log("Error reading file: ".concat(e))},a.onerror=function(e){return Me.log("Error reading file: ".concat(e))},a.onabort=function(e){return Me.log("File reading aborted: ".concat(e))},a.onload=function(i){Me.log("[DataChannel] Sending ".concat(i.target.result.byteLength," bytes")),n.send(i.target.result),t+=i.target.result.byteLength,e.recvSize=t,t<e.object.size&&o(t)};var o=function o(s){if(n.bufferedAmount>2097152)setTimeout((function(){return o(s)}),150);else{var r=e.object.slice(t,s+i);a.readAsArrayBuffer(r)}};o(0)}}},{key:"_updateFileState",value:function(e){this._sendSignalingMessage({type:"fileUpdated",fileInfo:e})}},{key:"_reloadSharePage",value:function(){window.location.href=window.location.origin+"/s"}},{key:"_randomToken",value:function(){for(var e=16,t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*i));return t}},{key:"getFiles",value:function(){return this._files}},{key:"addFile",value:function(e){var t={id:this._randomToken(),name:e.name,type:e.type,size:e.size,state:Te.ADDED,recvSize:0};this._sendSignalingMessage({type:"fileAdded",fileInfo:t}),t.object=e,this._files.push(t)}}]),e}(),He=Be,Ue=n("67bc"),Ge=n.n(Ue),Ye=n("c4e3"),Qe=n.n(Ye),We={name:"Share",components:{FileInput:De,FileList:xe,QRCodeCard:U,SpinnerLoading:$},data:function(){return{isDownloaded:!1,isDownloadingAll:!1,peer:{},configuration:{iceServers:[{urls:"stun:stun.bstocke.github.io/QR-file-share/:5349"},{urls:"turn:turn.qweroot.com:5349",username:"guest",credential:"somepassword"}]}}},computed:{isConnected:function(){return this.$store.getters.isConnected},isConnecting:function(){return!this.isConnected},isSocketReady:function(){return this.$store.getters.isSocketReady},isRestarting:function(){return this.$store.getters.isRestarting},isCallee:function(){return!!this.$route.params.roomId},files:function(){return this.peer.getFiles()},isMobile:function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}},mounted:function(){this.init()},methods:{init:function(){if(this.$route.params.roomId){var e=this.$route.params.roomId;this.peer=new He(this.configuration,e)}else this.peer=new He(this.configuration)},processFiles:function(e){var t=this;e.target.files.forEach((function(e){t.peer.addFile(e)}))},downloadAllAsZip:function(){var e=this;this.isDownloadingAll=!0;var t=Qe()();this.files.forEach((function(e){e.downloadableFile&&t.file(e.name,e.downloadableFile)})),t.generateAsync({type:"blob"}).then((function(t){e.isDownloadingAll=!1,e.isDownloaded=!0,me()(t,"files.zip")}))},keepScreenOn:function(){var e=new Ge.a;e.enable()},refreshPage:function(){window.location.href=window.location.origin+"/s"}}},Je=We,Ze=Object(u["a"])(Je,D,A,!1,null,null,null),Ke=Ze.exports;i["a"].use(C["a"]);var Xe=[{path:"/",name:"Home",component:R},{path:"/s",name:"Share",component:Ke},{path:"/s/:roomId",name:"ShareCallee",component:Ke}],et=new C["a"]({scrollBehavior:function(e){return e.hash?window.scrollTo({top:document.querySelector(e.hash).offsetTop,behavior:"smooth"}):{x:0,y:0}},mode:"history",base:"/",routes:Xe,linkActiveClass:"is-active"}),tt=et,nt=(n("a2f0"),n("9adb"),n("d093"),n("466d"),n("ac1f"),n("a925"));function it(){var e=n("49f8"),t={};return e.keys().forEach((function(n){var i=n.match(/([A-Za-z0-9-_]+)\./i);if(i&&i.length>1){var a=i[1];t[a]=e(n)}})),t}i["a"].use(nt["a"]);var at=new nt["a"]({locale:Object({VUE_APP_PROTOCOL:"https",VUE_APP_SIGNALING_ADDR:"https://signaling.bstocke.github.io/QR-file-share/",NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_I18N_LOCALE||"en",fallbackLocale:Object({VUE_APP_PROTOCOL:"https",VUE_APP_SIGNALING_ADDR:"https://signaling.bstocke.github.io/QR-file-share/",NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_I18N_FALLBACK_LOCALE||"en",messages:it()});i["a"].config.productionTip=!1,new i["a"]({router:tt,store:je,i18n:at,render:function(e){return e(y)}}).$mount("#app")},"8e7a":function(e,t,n){"use strict";n("2dd1")},a2f0:function(e,t,n){},edd4:function(e){e.exports=JSON.parse('{"home":{"hero":{"title1":"File sharing","title2":"made easy","subtitle":"Share your files between devices without installing anything, just hit the button below.","btn":{"path":"/","label":"Get Started"}},"tips":["Both iPhone and Android camera app can scan QR codes.","You can select multiple files at once."]},"share":{"alert":{"disconnected":{"title":"Disconnected","text":"Please go back to the browser screen on your mobile device to reconnect."}},"feedback":{"label":"If you need help or would like to provide feedback, please feel free to contact us at ","email":"fladrop@pm.me"},"kma":{"label":"Keep mobile screen on","desc":"Please keep mobile screen on while you are transferring big (or large amount of) files. The smartphone will automatically disconnected when the screen turns off."},"bmc":{"label":"&nbsp;If you like Fladrop, please buy me a coffee."},"fileInput":{"label1":"Upload files","label2":" or drag and drop"},"fileList":{"label":"Files","noFile":"No files selected"},"qrCode":{"caption":"Scan QR code to connect"}},"faq":{"title":"Frequently asked questions","caption":"Can\'t find the answer you\'re looking for? Reach out us at fladrop@pm.me.","questions":[{"q":"What is Fladrop?","a":"Fladrop is a file sharing web application."},{"q":"Is Fladrop better than other file sharing applications?","a":"Well, we won\'t say that the Fladrop is the best file sharing application at the time, and we also believe that every application has their own pros and cons. The main goal of Fladrop is to make file sharing as easy as possible, and since it\'s a web application, you don\'t need any wires or download any applications to share files, you can share any files to any device at any time just with an internet connection."},{"q":"Is Fladrop free?","a":"Yes, we made it completely free, forever. However, develop and maintain this little website cost us time and energy, we\'d love it if you can donate to us to support Fladrop."},{"q":"Is Fladrop secure?","a":"Yes, we use a technology called Webrtc, which transmits data through an end-to-end encrypted channel. You can learn more about it here"},{"q":"Does Fladrop store files?","a":"No, we don\'t store any file data. Although we collect the information about files such as file name and size for synchronization purposes, all information will be deleted within 24 hours."}]},"contact":{"title":"Contact","author":"This product is built by <a href=\'https://twitter.com/qweroot\' target=\'_blank\' class=\'text-blue-500\'>@Dylan Gye</a>.","text":"If you have any further questions or good ideas to improve this product, please contact me at <a href=\'mailto:qweroot@pm.me\' target=\'_top\' class=\'text-blue-500\'>qweroot@pm.me</a>."}}')}});
//# sourceMappingURL=app.d5d71a75.js.map